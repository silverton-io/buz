version: "3.9"

services:
  honeypot:
    container_name: honeypot
    image: ghcr.io/silverton-io/honeypot:v0.1.32
    volumes:
      - type: bind
        source: ./honeypot/honeypot1.conf.yml
        target: /etc/honeypot/config.yml
      - type: bind
        source: ../../schemas
        target: /schemas/
      - type: bind
        source: ../../site/index.html
        target: /app/site/index.html
    environment:
      - HONEYPOT_CONFIG_PATH=/etc/honeypot/config.yml
    ports:
      - 8080:8080
    deploy:
      restart_policy:
        condition: on-failure
    healthcheck:
      test: curl -f localhost:8080/health
      interval: 15s
    depends_on:
      relay:
        condition: service_started

  relay:
    container_name: relay
    image: ghcr.io/silverton-io/honeypot:v0.1.32
    volumes:
      - type: bind
        source: ./honeypot/honeypot2.conf.yml
        target: /etc/honeypot/config.yml
    environment:
      - HONEYPOT_CONFIG_PATH=/etc/honeypot/config.yml
    ports:
      - 8081:8081
    deploy:
      restart_policy:
        condition: on-failure
    healthcheck:
      test: curl -f localhost:8081/health
      interval: 15s
